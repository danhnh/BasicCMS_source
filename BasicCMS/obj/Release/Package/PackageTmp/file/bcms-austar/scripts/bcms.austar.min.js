bettercms.define("bcms.austar",["bcms.jquery","bcms","bcms.modal","bcms.siteSettings","bcms.dynamicContent","bcms.ko.extenders","bcms.ko.grid","bcms.grid","bcms.security","bcms.antiXss"],function(a,d,m,q,e,j,k,h,o,c){var s={},p={siteSettingsParentRow:"tr:first",siteSettingsRow:"tr",siteSettingsRowCells:"td",searchField:".bcms-search-query",searchButton:"#bcms-sitemaps-search-btn",siteSettingsHistoryButton:".bcms-grid-item-history-button",siteSettingsEditButton:".bcms-grid-item-edit-button",siteSettingsCreateButton:"#bcms-create-sitemap-button",siteSettingsDeleteButton:".bcms-grid-item-delete-button",siteSettingsTitleCell:".bcms-row-title",downloadSubscribersInCsv:"#download-subscribers-in-csv",siteSettingsButtonOpener:".bcms-btn-opener",siteSettingsButtonHolder:".bcms-btn-opener-holder",siteSettingsSitemapsForm:"#bcms-sitemaps-form"},l={loadSiteSettingsUniversitiesUrl:null,loadUniversitiesUrl:null,saveUniversityUrl:null,deleteUniversityUrl:null},g={creatorDialogTitle:null,editorDialogTitle:null};s.links=l;s.globalization=g;s.selectors=p;s.universitiesListViewModel=null;var r=(function(u){d.extendsClass(v,u);function v(w,y,x){u.call(this,w,l.loadUniversitiesUrl,y,x);}v.prototype.createItem=function(w){var x=new t(this,w);return x;};return v;})(k.ListViewModel);var t=(function(u){d.extendsClass(v,u);function v(x,w){u.call(this,x,w);var y=this;y.name=j.observable().extend({required:"",name:"",maxLength:{maxLength:200}});y.registerFields(y.name);y.name(w.Name);y.shortname=j.observable().extend({required:"",shortname:"",maxLength:{maxLength:200}});y.registerFields(y.shortname);y.shortname(w.ShortName);y.streetaddress=j.observable().extend({required:"",streetaddress:"",maxLength:{maxLength:200}});y.registerFields(y.streetaddress);y.streetaddress(w.StreetAddress);y.postcode=j.observable().extend({required:"",postcode:"",maxLength:{maxLength:200}});y.registerFields(y.postcode);y.postcode(w.PostCode);y.websiteurl=j.observable().extend({required:"",websiteurl:"",maxLength:{maxLength:200}});y.registerFields(y.websiteurl);y.websiteurl(w.WebsiteUrl);}v.prototype.getDeleteConfirmationMessage=function(){return a.format("Do you want to delete university {0}",this.name());};v.prototype.getSaveParams=function(){var w=u.prototype.getSaveParams.call(this);w.Name=this.email();w.ShortName=this.shortname();w.StreetAddress=this.streetaddress();w.PostCode=this.postcode();w.WebsiteUrl=this.websiteurl();return w;};v.prototype.getRowId=function(){if(!this.rowId){this.rowId="bcms-university-row-"+this.id();}return this.rowId;};return v;})(k.ItemViewModel);s.loadSiteSettingsUniversities=function(){e.bindSiteSettings(q,l.loadSiteSettingsUniversitiesUrl,{contentAvailable:s.initializeSiteSettingsUniversities});};s.initializeSiteSettingsUniversities=function(x){var v=q.getModalDialog(),u=v.container,w=u.find(p.siteSettingsSitemapsForm);h.bindGridForm(w,function(y){q.setContent(y);s.initializeSiteSettingsUniversities();});w.on("submit",function(y){d.stopEventPropagation(y);n(w);return false;});d.preventInputFromSubmittingForm(w.find(p.searchField),{preventedEnter:function(){n(w);}});w.find(p.searchButton).on("click",function(y){var z=a(this).parent();if(!z.hasClass("bcms-active-search")){w.find(p.searchField).prop("disabled",false);z.addClass("bcms-active-search");w.find(p.searchField).focus();}else{w.find(p.searchField).prop("disabled",true);z.removeClass("bcms-active-search");w.find(p.searchField).val("");}});if(x===true){w.find(p.searchButton).parent().addClass("bcms-active-search");}else{w.find(p.searchField).prop("disabled",true);}i(u);h.focusSearchInput(u.find(p.searchField),true);};s.loadAddNodeDialog=function(w,x,v){var u=new b();m.open({title:v||g.sitemapEditorDialogTitle,onLoad:function(y){e.setContentFromUrl(y,a.format(l.sitemapEditDialogUrl,w),{done:function(z){u.initialize(z,y);}});},onAccept:function(z){var y=forms.valid(z.container.find(p.sitemapForm));if(y){u.save(function(A){if(A.Success){z.close();if(x&&a.isFunction(x)){x(A);}messages.refreshBox(p.siteSettingsSitemapsForm,A);}else{sitemap.showMessage(A);}});}return false;}});};function f(w,u){var v=w.data("id");s.loadAddNodeDialog(v,function(y){if(y.Data!=null){var z=w.parents(p.siteSettingsParentRow),x=z.find(p.siteSettingsTitleCell);x.html(c.encodeHtml(y.Data.Name));z.find(p.siteSettingsDeleteButton).data("version",y.Data.Version);}},g.editorDialogTitle);}function n(u){h.submitGridForm(u,function(v){q.setContent(v);s.initializeSiteSettingsUniversities(true);});}function i(u,v){u.find(p.siteSettingsCreateButton).on("click",function(w){d.stopEventPropagation(w);addSitemap(v||u);});u.find(p.siteSettingsRowCells).on("click",function(x){d.stopEventPropagation(x);var w=a(this).parents(p.siteSettingsRow).find(p.siteSettingsEditButton);if(w.length>0){f(w,v||u);}});u.find(p.siteSettingsHistoryButton).on("click",function(w){d.stopEventPropagation(w);viewSitemapHistory(a(this),v||u);});u.find(p.siteSettingsDeleteButton).on("click",function(w){d.stopEventPropagation(w);deleteSitemap(a(this),v||u);});}function b(){var u=this;u.container=null;u.pageLinksModel=null;u.initialize=function(v,w){};u.save=function(v){};}s.init=function(){d.logger.info("Initializing bcms.austar module.");};d.registerInit(s.init);return s;});